<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=1920, initial-scale=1.0" />
		<title>Intermission</title>
		<style>
			body {
				margin: 0;
				--main-col: #2b315c;
				--sec-col: #0082c8;
				--asm-orange: #cc7722;
				--text-col: #f2dab2;
			}
		</style>
		<link rel="stylesheet" href="./elements/fonts/noto-sans/notosans.css" />
		<link rel="stylesheet" href="./elements/fonts/ds-digital/ds-digital.css" />
		<link rel="stylesheet" href="./elements/fonts/sharetechmono/sharetechmono.css" />
		<link rel="stylesheet" href="./elements/fonts/work-sans/work-sans.css" />
		<link rel="stylesheet" href="./elements/fonts/national-park/national-park.css" />
		<link rel="stylesheet" href="https://use.typekit.net/vqf8rdg.css" />

		<script src="https://xemantic.github.io/shader-web-background/dist/shader-web-background.min.js"></script>

		<script type="frag" id="Image">
			precision highp float;

			uniform vec2  iResolution;
			uniform float iTime;

			// -- Paste your Shadertoy code here:

			const float xSpeed = 0.02;
			const float ySpeed = 0.01;
			const float zSpeed = 0.002;
			const float scale = 5.;

			#define tanh(x)  ((pow(2.71828, x) - pow(2.71828, -x))/(pow(2.71828, x) + pow(2.71828, -x)))

			float noise3( vec3 x , out vec2 g) {
			    vec3 p = floor(x),f = fract(x),
			        F = f*f*(3.-2.*f);  // or smoothstep     // to make derivative continuous at borders

			#define hash3(p)  fract(sin(1e3*dot(p,vec3(1,57,-13.7)))*4375.5453)        // rand

			    float v000 = hash3(p+vec3(0,0,0)), v100 = hash3(p+vec3(1,0,0)),
			          v010 = hash3(p+vec3(0,1,0)), v110 = hash3(p+vec3(1,1,0)),
			          v001 = hash3(p+vec3(0,0,1)), v101 = hash3(p+vec3(1,0,1)),
			          v011 = hash3(p+vec3(0,1,1)), v111 = hash3(p+vec3(1,1,1));

			    g.x = 6.*f.x*(1.-f.x)                        // gradients
			          * mix( mix( v100 - v000, v110 - v010, F.y),
			                 mix( v101 - v001, v111 - v011, F.y), F.z);
			    g.y = 6.*f.y*(1.-f.y)
			          * mix( mix( v010 - v000, v110 - v100, F.x),
			                 mix( v011 - v001, v111 - v101, F.x), F.z);

			    return mix( mix(mix( v000, v100, F.x),       // triilinear interp
			                    mix( v010, v110, F.x),F.y),
			                mix(mix( v001, v101, F.x),
			                    mix( v011, v111, F.x),F.y), F.z);
			}


			float noise(vec3 x, out vec2 g) {     // pseudoperlin improvement from foxes idea
			    vec2 g0,g1;
			    float n = (noise3(x,g0)+noise3(x+11.5,g1)) / 2.;
			    g = (g0+g1)/2.;
			    return n;
			}


			void mainImage( out vec4 O, vec2 U ) // ------------ draw isovalues
			{
			    vec2 R = iResolution.xy;
			    U *= scale/R.y;
			    vec2 g;
			    float n = noise(vec3(U.x + xSpeed*iTime, U.y + ySpeed*iTime, zSpeed * iTime), g);
			    float v = sin(6.28*10.*n);
			    g *= 6.28*10.*cos(6.28*10.*n) * 8./R.y;
			    v = tanh(min(2.*abs(v) / (abs(g.x)+abs(g.y)),10.)); // some systems dislike tanh(big)
			    n = floor(n*20.)/20.;

			    O = (v * vec4(0.04, 0.05, 0.07, 1)) + vec4(0.15, 0.09, 0.01, 1);
			}

			// -- End of Shadertoy code


			void main() {
				mainImage(gl_FragColor, gl_FragCoord.xy);
			}
		</script>
		<script>
			console.log("Hi?")
			shaderWebBackground.shade({
				shaders: {
					Image: {
						uniforms: {
							iResolution: (gl, loc, ctx) => gl.uniform2f(loc, ctx.width, ctx.height),
							iTime: (gl, loc) => gl.uniform1f(loc, performance.now() / 1000),
						},
					},
				},
			});
		</script>
	</head>
	<body>
		<div id="intermission"></div>
		<script type="module" src="./intermission.tsx"></script>
	</body>
</html>
